image: microsoft/aspnetcore-build
pipelines:
  default:
    - step:
        script:
          # Generate build number 
          - BUILD_NUMBER=`printf "%03d" $(git log --oneline | wc -l)`
          - echo "Build number':' ${BUILD_NUMBER} (will be appended to the generated NuGet package version)"
          #
          # Restore packages
          - dotnet restore
          # Build project
          - dotnet build
          # Run tests (uncomment to run tests)
          # - dotnet test
          # Create package
          - dotnet pack --configuration ${BUILD_CONFIGURATION} --version-suffix beta-${BUILD_NUMBER} --output ../../build --verbosity d
          # Push generated package(s)
          - dotnet nuget push build/*.nupkg -k ${MYGET_NUGET_APIKEY} -s ${MYGET_NUGET_URL} 
          - dotnet nuget push build/*.nupkg -k ${NUGET_APIKEY} -s ${NUGET_URL}
          
  branches:
    master:
      - step:
          script:
            # Generate build number 
            - BUILD_NUMBER=`printf "%03d" $(git log --oneline | wc -l)`
            - echo "Build number':' ${BUILD_NUMBER} (will be appended to the generated NuGet package version)"
            #
            # Restore packages
            - dotnet restore
            # Build project
            - dotnet build
            # Run tests (uncomment to run tests)
            # - dotnet test
            # Create package
            - dotnet pack --configuration ${BUILD_CONFIGURATION} --output ../../build --verbosity d
            # Push generated package(s)
            - dotnet nuget push build/*.nupkg -k ${MYGET_NUGET_APIKEY} -s ${MYGET_NUGET_URL} 
          - dotnet nuget push build/*.nupkg -k ${NUGET_APIKEY} -s ${NUGET_URL}